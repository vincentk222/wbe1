<!-- auth.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Authentification</title>
</head>
<body>
<script>
    const returnedState = new URLSearchParams(window.location.search).get('state');
    const originalState = localStorage.getItem('oauthState');

    if (returnedState && returnedState === originalState) {
        console.log("La vérification CSRF a réussi.");
        // Procéder à l'échange du code d'autorisation contre un token, etc.
        // Supposer que l'authentification et la récupération des informations de l'utilisateur ont réussi
        localStorage.setItem('isAuthenticated', 'true');
        // Rediriger vers une page protégée ou la page d'accueil
        window.location.href = 'test.html';
    } else {
        console.error("Erreur de vérification CSRF. Redirection vers la page de connexion.");
        window.location.href = 'login.html';
    }

    // Nettoyer la valeur `state` stockée
    localStorage.removeItem('oauthState');
</script>
</body>
</html>
