<!-- auth.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Authentification</title>
    <script src="https://alcdn.msauth.net/browser/2.13.1/js/msal-browser.min.js" integrity="sha384-+vJGnYt4zLXAClD9H+6jLpM9G5SfnwWlWlYvT7l0jX4Hj5QfZIvdia5VnR6bnX8w" crossorigin="anonymous"></script>
</head>
<body>
    <script>
        const msalConfig = {
            auth: {
                clientId: localStorage.getItem('clientID'),
                authority: `https://login.microsoftonline.com/${localStorage.getItem('tenantID')}`,
                redirectUri: window.location.origin + "/auth.html"
            }
        };
    
        const myMSALObj = new msal.PublicClientApplication(msalConfig);
        
        myMSALObj.handleRedirectPromise().then(response => {
            if (response) {
                const account = response.account;
                myMSALObj.acquireTokenSilent({
                    scopes: ["User.Read"],
                    account: account
                }).then(response => {
                    // Avec le token, appelez Microsoft Graph API pour récupérer les infos utilisateur
                    console.log(response);
                    // Traitez la réponse ici
                }).catch(err => {
                    // Gestion des erreurs
                    console.error(err);
                });
            } else {
                // Gestion de l'absence de réponse de redirection
                console.log("Aucune réponse de redirection. L'utilisateur pourrait charger la page directement ou la réponse de connexion est dans le cache.");
            }
        }).catch(err => {
            // Gestion des erreurs lors de la capture de la réponse de redirection
            console.error(err);
        });
    </script>
    
</body>
</html>
